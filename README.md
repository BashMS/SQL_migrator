# SQL_migrator
SQL DB version and release management service

# Сервис, работающий с миграциями, написанными на Go или представленными в виде SQL-файлов.

Позволяет:
* Генерировать шаблон миграции;
* Применять миграции;
* Откатывать миграции;
* Устанавливается в $GOPATH/bin командой go get github.com/BashMS/SQL_migrator/cmd/gomigrator;
* Можно использовать её API в своих программах напрямую, импортировав библиотеку как пакет.

### Архитектура
  Инструмент создавать свои служебные таблицы в БД для контроля версий.
   * Статус (применена, применяется, ошибка и пр.)
   * Время последнего обновления статуса
   * Имя миграции (версия)

  
# Команды
 Создание миграции
 * $ gomigrator create <имя_миграции>
 Применение всех миграций
 * $ gomigrator up
 Откат последней миграции
 * $ gomigrator down
 Повтор последней миграции (откат + накат)
 * $ gomigrator redo
 Вывод статуса миграций
 * $ gomigrator status
 Вывод версии базы
 * $ gomigrator dbversion - по сути номер последней примененной миграции.

# Формат миграций

Если миграция в формате Go-кода, то она может иметь формат:

func Up_migration(o *someObject) {
}

func Down_migration(o *someObject) {
}
Где someObject - один из аргументов, которые вы считаете, могут пригодиться при описании миграции (транзакция, структура вашей библиотеки и пр.)

Если миграция в формате SQL, то необходимо придумать способ разделения между Up и Down шагами, например, с помощью комментариев.

## Конфигурация

Основные параметры:
* Строка подключения (DSN) к БД
* Путь к директории с файлами миграций
* Тип миграции: go/sql
Конфигурировать можно как через аргументы командной строки, так и через файл, при этом в файле можно указывать переменные окружения.